## 2 API Surface and Routing (DevOps + Choreo APIs)

This section describes how **Rudder**â€™s HTTP router is structured, showing the top-level route map in `api/api.go` and how it delegates to grouped route registrations under `api/routes/*` (DevOps endpoints) and `choreo/routes/*` (Choreo-specific endpoints) .

### 2.1 Router map and endpoint groups

The `LoadAPI()` function in `api/api.go` wires up the global middleware and mounts these route groups:

```go
r := chi.NewRouter()
â€¦  
r.Route("/healthz", routes.HealthRoutes)
r.Route("/", func(r chi.Router) {
  r.Use(request-cache middlewareâ€¦)
  r.Route("/api/v1/", func(r chi.Router) {
    r.Route("/component",     routes.AppRoutes)
    r.Route("/metrics",       routes.MetricRoutes)
    r.Route("/choreo/domains",    choreo_routes.DomainRoutes)
    r.Route("/choreo/organizations", choreo_routes.OrganizationRoutes)
    r.Route("/choreo/projects",      choreo_routes.ProjectRoutes)
    r.Route("/choreo/environments",  choreo_routes.EnvironmentRoutes)
    r.Route("/choreo/components",    choreo_routes.ComponentRoutes)
    r.Route("/choreo/mappings",      choreo_routes.MappingRoutes)
    r.Route("/configmaps",     routes.ConfigMapRoutes)
    r.Route("/secrets",        routes.SecretRoutes)
    r.Route("/volume",         routes.VolumeRoutes)
    r.Route("/network-policies", choreo_routes.NetworkPolicyRoutes)
    r.Route("/code-server",    routes.RegisterCodeServerRoutes)
  })
  r.Route("/choreo/webhooks/v1",   choreo_routes.WebhookRoutes)
  r.Route("/webhook/v1/",          routes.WebhookRoutes)
  r.Route("/internal/admin",       choreo_routes.AdminRoutes)
  r.Route("/choreo/autodeploy/v1", choreo_routes.AlertsRoutes)
  r.Route("/choreo/release-mgt/v1", choreo_routes.ReleaseManagementRoutes)
})
return r, nil
```

Below is an **inventory** of all top-level route prefixes, where theyâ€™re registered, and where their handlers live.

| ðŸŒ Route Prefix | âš™ï¸ Registered In | ðŸ“‚ Handler Package |
| --- | --- | --- |
| **/healthz** | `routes.HealthRoutes` (api/routes/health.go) | `choreo/handlerutils` (via inline health check) ï¹£ HealthRoutes defines a single GET handler checking DB connectivity |
| **/api/v1/component** | `routes.AppRoutes` (api/routes/app.go) | `choreo/handlers` (ChoreoBYOCAppCreate, ChoreoBYOIAppCreateâ€¦) |
| **/api/v1/metrics** | `routes.MetricRoutes` (api/routes/metrics.go) | `api/handlers` (GetMetricDeployments, â€¦) & `choreo/handlerutils` |
| **/api/v1/choreo/domains** | `choreo_routes.DomainRoutes` (choreo/routes/domain.go) | `choreo/handlers` (OrganizationInit, listCustomDomainsâ€¦) |
| **/api/v1/choreo/organizations** | `choreo_routes.OrganizationRoutes` (choreo/routes/environment.go) | `choreo/handlers` (OrganizationInit, OrganizationWebappDeploymentHourStatusâ€¦) |
| **/api/v1/choreo/projects** | `choreo_routes.ProjectRoutes` (choreo/routes/environment.go) | `choreo/handlers` (ProjectInit, ComponentsByProjectâ€¦) |
| **/api/v1/choreo/environments** | `choreo_routes.EnvironmentRoutes` (choreo/routes/environment.go) | `choreo/handlers` (ChoeoEnvironmentList, DeployEnvironmentNamespaceâ€¦) |
| **/api/v1/choreo/components** | `choreo_routes.ComponentRoutes` (choreo/routes/components.go) | `choreo/handlers` (ChoreoComponentReleaseCreate, â€¦) |
| **/api/v1/choreo/mappings** | `choreo_routes.MappingRoutes` (choreo/routes/components.go) | `choreo/handlers` (ChoreoComponentByReleaseId, â€¦) |
| **/api/v1/configmaps** | `routes.ConfigMapRoutes` (api/routes/configmap.go) | `api/handlers` (ConfigMapCreate, ConfigMapListâ€¦) |
| **/api/v1/secrets** | `routes.SecretRoutes` (api/routes/secret.go) | `api/handlers` (SecretCreate, SecretListâ€¦) |
| **/api/v1/volume** | `routes.VolumeRoutes` (api/routes/volume.go) | `api/handlers` (VolumeCreate, VolumeListâ€¦) |
| **/api/v1/network-policies** | `choreo_routes.NetworkPolicyRoutes` (choreo/routes/networkpolicy.go) | `choreo/handlers` (NetworkPolicyGet, NetworkPolicyListâ€¦) |
| **/api/v1/code-server** | `routes.RegisterCodeServerRoutes` (api/routes/code_server.go) | `choreo/handlers` (CodeServerSvc methodsâ€¦) |
| **/choreo/webhooks/v1** | `choreo_routes.WebhookRoutes` (choreo/routes/webhook.go) | `choreo/handlers` (Webhook: saveDeploymentTrackImage, deployNewImageâ€¦) |
| **/webhook/v1/** | `routes.WebhookRoutes` (api/routes/webhook.go) | `choreo/handlers` (DeployNewImageToContainerâ€¦) |
| **/internal/admin** | `choreo_routes.AdminRoutes` (choreo/routes/admin.go) | `choreo/handlers` (AdminGetRecentDeployments, RedeployComponentâ€¦) |
| **/choreo/autodeploy/v1** | `choreo_routes.AlertsRoutes` (choreo/routes/alerts.go) | `choreo/handlers` (Alerting endpointsâ€¦) |
| **/choreo/release-mgt/v1** | `choreo_routes.ReleaseManagementRoutes` (choreo/routes/release_management.go) | `choreo/handlers` (DeployRelease, ListDeploymentsâ€¦) |


> **card** { "title": "Handler Locations", "content": "All DevOps-style endpoints live under `api/handlers`; Choreo-centric endpoints live under `choreo/handlers`. Route configuration files are in `api/routes` and `choreo/routes`." }

Every route group may further nest sub-routes (e.g., `ComponentRoutes` under `/api/v1/choreo/components` defines endpoints for releases, dependencies, endpoints, config maps, etc.). Handlers carry out request validation via `choreo/reqvalidators`, delegate to controllers in `choreo/bundles/*`, and respond using `choreo/handlerutils`. This structured approach cleanly separates the DevOps API surface from the richer Choreo control-plane integrations.