# 19.2 Schema Evolution by Feature Area (Grouped Tour of Major Tables)

This section groups the 182+ migrations into **functional domains**, highlighting how the database schema evolved to support Rudder‚Äôs features. Each domain lists key migrations, affected tables or columns, and representative examples.

---

## 19.2.1 Applications, Environments & Versioning

This domain covers tables that track applications, their environments, and version metadata.

| Migration ID | Script Name | Affected Table | Description |
| --- | --- | --- | --- |
| 0.0.142 | version_table_byoci_columns.go | **choreo_api_versions** | Added `image_repository_name`, `image_name` |
| 0.0.144 | version_table_byoci_columns.go (BYOI) | **choreo_api_versions** | Added BYOI image columns |
| 0.0.146 | version_table_deployment_track_columns.go | **choreo_api_versions** | Added `description`, `version_strategy` |
| 0.0.072 | pdb_table.go | **pdbs** | Created PodDisruptionBudget table |
| 0.0.047 | domain_environment.go | **custom_domains** | Added `environment_id` column |
| 0.0.084 | domain_env_fk.go | **custom_domains** | Added FK to `environments` |
| 0.0.098 | add_namespace_migration_table.go | **namespace_migrations** | Auto-migrated namespace history |
| 0.0.103 | update_namespace_migration_table.go | **namespace_migrations** | Recreated namespace migration with new fields |
| 0.0.094 | release_projectid_idx.go | **app_environments** | Indexed by `project_id` |
| 0.0.122 | release_cdp_webapp_name.go | **app_environments** | Added `cdp_short_url_name` + unique index |


**Representative Migration (0.0.146)**

```go
// Migration 146: Enhance version metadata
addDescriptionColumn := `ALTER TABLE choreo_api_versions ADD description NVARCHAR(4000)`
addVersionStrategy  := `ALTER TABLE choreo_api_versions ADD version_strategy VARCHAR(100) DEFAULT 'LegacyMajorMinorPatch' NOT NULL`
RegisterMigration(gormigrate.Migration{
  ID: "0.0.146",
  Migrate: func(db *gorm.DB) error {
    return db.Transaction(func(tx *gorm.DB) error {
      return runSQL(tx, addDescriptionColumn, addVersionStrategy)
    })
  },
})
```

---

## 19.2.2 Release Management üöÄ

This domain structures how releases and their deployments are recorded.

| Migration ID | Script Name | Main Tables | Description |
| --- | --- | --- | --- |
| 0.0.213 | create_release_management_tables.go | **releases**, **release_deployments**, **release_activity_logs** | Created core release tables + indexes |


**Representative DDL Snippet**

```sql
CREATE TABLE releases (
  id               UNIQUEIDENTIFIER PRIMARY KEY,
  organization_id  NVARCHAR(255),
  project_id       NVARCHAR(255),
  release_date     DATE,
  release_number   INT,
  status           NVARCHAR(50) DEFAULT 'PENDING',
  created_at       DATETIME2 DEFAULT GETDATE(),
  updated_at       DATETIME2 DEFAULT GETDATE(),
  CONSTRAINT unique_release_date_number_per_component_deployment_track 
    UNIQUE (release_date, release_number, component_id, deployment_track_id)
);
```

---

## 19.2.3 Component Configuration & Dependencies ‚öôÔ∏è

Tables that manage component-level settings, secrets, and inter-component dependencies.

| Migration ID | Script Name | Table | Description |
| --- | --- | --- | --- |
| 0.0.198 | add_configuration_table.go | **configurations** | Created app-environment-specific config overrides |
| 0.0.156 | component_dependency_table_config_id_columns.go | **component_dependencies** | Added config-mapping FK columns |
| 0.0.158 | update_dependency_table.go | **component_dependencies** | Recreated table with new state and FK constraints |


**Representative Migration (0.0.158)**

```sql
CREATE TABLE component_dependencies (
  id                     UNIQUEIDENTIFIER PRIMARY KEY,
  service_identifier     VARCHAR(250),
  state                  NVARCHAR(MAX),
  state_reason           NVARCHAR(MAX),
  deployment_track_id    UNIQUEIDENTIFIER,
  config_mapping_id      VARCHAR(100),
  CONSTRAINT fk_component_dependencies_deployment_track
    FOREIGN KEY (deployment_track_id) REFERENCES choreo_api_versions(id) ON DELETE CASCADE
);
```

---

## 19.2.4 Network Policies & Egress

Tables supporting network migration tracking and policy contexts.

| Migration ID | Script Name | Table | Description |
| --- | --- | --- | --- |
| 0.0.140 | cilium_migrate.go | **cilium_migrates** | Created migration tracking for Cilium flows |
| 0.0.148 | add_region_to_cilium_org.go | **cilium_migrate_orgs** | Expanded PK to include `region` |
| 0.0.180 | add_security_contexts_table.go | **component_security_contexts** | Created per-component security context |


---

## 19.2.5 Endpoints, Resiliency & Gateway Revisions üîå

Schema changes around API endpoints, resiliency configs, and gateway revision IDs.

| Migration ID | Script Name | Table | Description |
| --- | --- | --- | --- |
| 0.0.139 | endpoint_columns.go | **component_endpoints** | Added hash columns for spec and YAML |
| 0.0.189 | add_gw_revisionId_columns_to_component_endpoints.go | **component_endpoints** | Added `internal_gw_revision_id`, `external_gw_revision_id` |
| 0.0.199 | add_is_scope_added_column.go | **component_endpoints** | Added `is_scope_added` flag |


---

## 19.2.6 Auto-Scaling & Resiliency

Tables and indexes for HTTP scaler configurations.

| Migration ID | Script Name | Table | Description |
| --- | --- | --- | --- |
| 0.0.134 | http_scaler_v2.go | **http_scalers** | Created table for HTTP-based scaling parameters |
| 0.0.130 | add_http_scaler.go | **http_scalers** | (Skipped) initial scaler creation script |


---

## 19.2.7 Code Server Entries üñ•Ô∏è

Tracks the interactive code-server state for components.

| Migration ID | Script Name | Table | Description |
| --- | --- | --- | --- |
| 0.0.209 | update_code_server.go | **code_server_entries** | Truncated table, altered columns, added FKs |
| 0.0.212 | add_version_id_column_to_code_server.go | **code_server_entries** | Created indexes on user, org, project, component |


---

## 19.2.8 Image Registries & Versions üì¶

Captures registry metadata and image versioning details.

| Migration ID | Script Name | Table | Description |
| --- | --- | --- | --- |
| 0.0.138 | byoci_columns.go | **image_registries** | Added `container_registry_id`, `image_name` |
| 0.0.142 | version_table_byoci_columns.go | **image_registries** | Added `container_registry_url` |
| 0.0.144 | version_table_byoci_columns.go | **choreo_api_versions** | BYOI image tag support |


---

## 19.2.9 Observability & Health Checks üìä

Tables for runtime metrics, health check constraints, and audit trails.

| Migration ID | Script Name | Table | Description |
| --- | --- | --- | --- |
| 0.0.205 | add_observability_config.go | **observability_configs** | Created per-environment observability flags |
| 0.0.081 | health_check_table_constraints.go | **health_checks** | Cleaned data, altered FKs and indexes |


---

<aside>

üí° **Key Takeaway**

This tour shows how Rudder‚Äôs MSSQL schema evolved along feature areas‚Äîfrom core app/version tracking to release orchestration, endpoint resiliency, and observability.

</aside>